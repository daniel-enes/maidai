<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{components/layout}">
<head>
    <title>Pessoas</title>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
</head>
<body>
<main class="light flex-grow-8 padding-20"  layout:fragment="content">
    <h1>Pessoas</h1>
    <div>
        <div>
            <p>
                <svg class="vertical-align-middle" width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path fill="#03a696" d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM232 344l0-64-64 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l64 0 0-64c0-13.3 10.7-24 24-24s24 10.7 24 24l0 64 64 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-64 0 0 64c0 13.3-10.7 24-24 24s-24-10.7-24-24z"/></svg>
                <a th:href="@{/people/create}">Cadastrar nova Pessoa</a>
            </p>
        </div>

        <!-- Alert component -->
        <div th:replace="~{components/alert :: alert}"></div>

        <!-- Search name component -->
        <div th:replace="~{components/search-name :: search-name}"></div>

        <!-- Search Form -->
        <!-- Simple Name Search Form -->
<!--        <form th:action="@{'/' + ${baseViewPath}}" method="get">-->
<!--            <div id="search" class="relative">-->
<!--                <i class="fas fa-search"></i>-->
<!--                <input type="search"-->
<!--                       class="search"-->
<!--                       name="name"-->
<!--                       placeholder="Buscar pelo nome"-->
<!--                >-->
<!--            </div>-->
<!--&lt;!&ndash;            <input th:if="${param.page != null}" type="hidden" name="page" th:value="${param.page}">&ndash;&gt;-->
<!--&lt;!&ndash;            <input th:if="${param.size != null}" type="hidden" name="size" th:value="${param.size}">&ndash;&gt;-->
<!--                <input th:if="${param.sort != null}" type="hidden" name="sort" th:value="${param.sort}">-->
<!--        </form>-->

        <!-- Filter Form -->
        <form th:action="@{'/' + ${baseViewPath} + '?sort=name,asc'}" method="get">
            <label for="personType">Filtrar por tipo: </label>
            <div>
                <select name="filter" id="personType">
                    <option value="">Sem filtro</option>
                    <option value="personType:bolsista">Bolsista</option>
                    <option value="personType:orientador">Orientador</option>
                </select>

                <input type="hidden" name="page" th:value="${param.page}">
                <input type="hidden" name="size" th:value="${param.size}">

                <button type="submit" class="button success font-light">Buscar</button>
            </div>
        </form>

        <!-- TOTAL AMOUNT FOUND component -->
        <div th:replace="~{components/total-amount-found :: total-amount-found}"></div>

        <!-- PAGINATION component -->
        <div th:replace="~{components/pagination :: pagination}"></div>

        <table>
            <thead>
            <tr>
                <th>
                    <a th:href="@{'/' + ${baseViewPath} +
                        '?page=' + ${entityList.number} +
                        '&size=' + ${entityList.size} +
                        '&sort=name,' +
                        ${(sort == '' || sort == 'name,asc') ? 'desc' : 'asc' } +
                        ${typeId != null ? '&typeId='+typeId : ''}
                        }">
                        Nome
                        <span>
                            <i th:class="${(sort == '' || sort == 'name,asc') ? 'fa fa-sort-up' : 'fa fa-sort-down'}"></i>
                        </span>
                    </a>
                </th>
                <th>CPF</th>
                <th>Telefone</th>
                <th>Email</th>
                <th>
                    <a th:href="@{'/' + ${baseViewPath} +
                        '?page=' + ${entityList.number} +
                        '&size=' + ${entityList.size} +
                        '&sort=personTypeType,' +
                        ${(sort == '' || sort == 'personTypeType,asc') ? 'desc' : 'asc' }
                        }">
                        Tipo
                        <span>
                            <i th:class="${(sort == '' || sort == 'personTypeType,asc') ? 'fa fa-sort-up' : 'fa fa-sort-down'}"></i>
                        </span>
                    </a>
                </th>
                <th>Status</th>
                <th>Editar</th>
                <th>Apagar</th>
            </tr>
            </thead>
            <tbody>
            <tr th:if="${entityList.totalElements == 0}">
                <td colspan="2">Nenhuma pessoa encontrada</td>
            </tr>
            <tr th:each="person : ${entityList}">
                <td>
                    <a th:text="${person.name}" th:href="@{/people/{id}(id=${person.id})}">Nome</a>
                </td>
                <td th:text="${person.cpf}">CPF</td>
                <td th:text="${person.phone}">Telefone</td>
                <td th:text="${person.email}">Email</td>
                <td th:text="${person.personType.type}">Tipo</td>
                <td>
                    <th:block th:if="${person.personType.id == 1 and #lists.isEmpty((person.ppgList))}">
                        <a th:href="@{/people/{id}(id=${person.id})}">
                            Cadastar em PPG
                        </a>
                    </th:block>
                    <span th:if="${person.personType.id == 1 and not #lists.isEmpty((person.ppgList))}">
                        sem pendÃªncias
                    </span>
                </td>
                <td class="text-center">
                    <a th:href="@{/people/{id}/edit(id=${person.id})}"
                       role="button"
                       aria-label="Editar pessoa"
                    >
                        <svg title="Editar" class="vertical-align-middle" width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path fill="#03a696" d="M224 256A128 128 0 1 0 224 0a128 128 0 1 0 0 256zm-45.7 48C79.8 304 0 383.8 0 482.3C0 498.7 13.3 512 29.7 512l293.1 0c-3.1-8.8-3.7-18.4-1.4-27.8l15-60.1c2.8-11.3 8.6-21.5 16.8-29.7l40.3-40.3c-32.1-31-75.7-50.1-123.9-50.1l-91.4 0zm435.5-68.3c-15.6-15.6-40.9-15.6-56.6 0l-29.4 29.4 71 71 29.4-29.4c15.6-15.6 15.6-40.9 0-56.6l-14.4-14.4zM375.9 417c-4.1 4.1-7 9.2-8.4 14.9l-15 60.1c-1.4 5.5 .2 11.2 4.2 15.2s9.7 5.6 15.2 4.2l60.1-15c5.6-1.4 10.8-4.3 14.9-8.4L576.1 358.7l-71-71L375.9 417z"/></svg>
                    </a>
                </td>
                <td class="text-center">
                    <a th:href="@{/people/{id}(id=${person.id})}"
                       th:data-url="@{/people/{id}(id=${person.id})}"
                       onclick="return deleteEntity(this.getAttribute('data-url'), event)"
                       role="button"
                       aria-label="Apagar pessoa"
                    >
                        <svg class="vertical-align-middle" width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path fill="#03a696" d="M135.2 17.7L128 32 32 32C14.3 32 0 46.3 0 64S14.3 96 32 96l384 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-96 0-7.2-14.3C307.4 6.8 296.3 0 284.2 0L163.8 0c-12.1 0-23.2 6.8-28.6 17.7zM416 128L32 128 53.2 467c1.6 25.3 22.6 45 47.9 45l245.8 0c25.3 0 46.3-19.7 47.9-45L416 128z"/></svg>
                    </a>

                </td>
            </tr>
            </tbody>
        </table>

        <!-- PAGINATION component -->
        <div th:replace="~{components/pagination :: pagination}"></div>

        <!-- TOTAL AMOUNT FOUND component -->
        <div th:replace="~{components/total-amount-found :: total-amount-found}"></div>

    </div>
</main>
</body>
</html>